<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Go | /home/lunarxlark/.config/blog</title><meta name=keywords content><meta name=description content><meta name=author content><link rel=canonical href=https://lunarxlark.github.io/tags/go/><link crossorigin=anonymous href=/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn+yY=" rel="preload stylesheet" as=style><link rel=icon href=https://lunarxlark.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lunarxlark.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lunarxlark.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://lunarxlark.github.io/apple-touch-icon.png><link rel=mask-icon href=https://lunarxlark.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://lunarxlark.github.io/tags/go/index.xml title=rss><link rel=alternate hreflang=ja href=https://lunarxlark.github.io/tags/go/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-HC9218ZECN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HC9218ZECN")}</script><meta property="og:url" content="https://lunarxlark.github.io/tags/go/"><meta property="og:site_name" content="/home/lunarxlark/.config/blog"><meta property="og:title" content="Go"><meta property="og:locale" content="ja"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go"><meta name=twitter:description content></head><body class="list dark" id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lunarxlark.github.io/ accesskey=h title="/home/lunarxlark/.config/blog (Alt + H)">/home/lunarxlark/.config/blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lunarxlark.github.io/ title=Home><span>Home</span></a></li><li><a href=https://lunarxlark.github.io/about title=About><span>About</span></a></li><li><a href=https://lunarxlark.github.io/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>Go</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Neovim + DAP + Go</h2></header><div class=entry-content><p>TL;DR DAP(Debug Adapter Protocol)の力を借りれば、Neovim上でも視覚的にGoのデバッグが出来ました。 ここでは下記については話しません。
DAPの詳細 packer.nvimでのインストール方法 vscode-goのdebugAdapter.jsの使用方法 Neovimでデバッグするモチベーション v0.2.2から色々変わったNeovimを久々に触ってみようかと思いinit.luaへ以降して遊んでいました。 起動が早いだけでなく、LSP系の動作もサクサク動いてここ2ヶ月程快適に過ごしています。
ただ、VSCodeでのデバッグ機能がとても便利なため、デバッガ使用時のみこの快適な環境を離れていました。
どうにかNeovim上で完結させられないか…。
DAP DAPの説明はリンク先や他HPをご参照ください。
イメージを持ってもらうためLSPを引き合いに出すと、LSPがテキスト編集時に定義や変更内容や補完候補等を返すのに対して、DAPはデバッガとやりとりしてデバッグ情報を返す位のイメージを持ってもらえれば大丈夫だと思います。
Neovim + DAP + Go 使うプラグインは下記になります。
mfussenegger/nvim-dap : NeovimのDAPクライアント。VSCodeのlaunch.jsonも使用可 rcarriga/nvim-dap-ui : nvim-dapを視覚的に操作しやすいUI leoluz/nvim-dap-go : DAPのGo用設定(delve dap起動) nvim-treesitter/nvim-treesitter nvim-dap-goでテストをデバッグする際、近くのテストを見つけるのに必要 packer.nvimの設定 VSCodeのlaunch.jsonを使用しない場合、require('dap.ext.vscode').load_launchjs()は不要です。 launch.jsonを読み込めた場合、デバッグ方法の選択時にlaunch.jsonの内容が追加表示されて選択可能になります。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 -- dap plugin installation with packer.nvim ... -- dap use { "rcarriga/nvim-dap-ui", requires = { "mfussenegger/nvim-dap", "leoluz/nvim-dap-go", "nvim-treesitter/nvim-treesitter" }, config = function () vim.fn.sign_define('DapBreakpoint', {text='⛔', texthl='', linehl='', numhl=''}) vim.fn.sign_define('DapStopped', {text='👉', texthl='', linehl='', numhl=''}) require('dapui').setup() require('dap-go').setup() require('dap.ext.vscode').load_launchjs() end } ... GoでDAPを起動する際の設定 Goの場合、vscode-goのdebugAdapter.jsを使用することも出来ます。ここでは、delveを待ち構えさせます。
...</p></div><footer class=entry-footer><span title='2021-11-24 00:00:00 +0000 UTC'>2021年11月24日</span>&nbsp;·&nbsp;<span>3 分</span></footer><a class=entry-link aria-label="post link to Neovim + DAP + Go" href=https://lunarxlark.github.io/articles/20211124_nvim-dap-go/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>gin + gorm v2でのセッションやトランザクション</h2></header><div class=entry-content><p>TL;DR ginでの各リクエストを1セッションで管理しつつ、トランザクションも管理したい。
ginのmiddlewareで、gin.Contextにgorm.WithContextを用いてGormのセッションを持たせる。 ginの各HandlerFuncの中では、gin.Context内のGormセッションからDBへアクセスする。 モチベーション Gormはv2になり色々と変わった。 Gorm 2.0 Release Note
色々な記事が書かれているがTransactoinに関してあまり書かれていない。
下記疑問を払拭して正しい使い方を自分なりに確かめたかったので試した。
なんとなく動くがこれで正しいのか? ドキュメントを読んでいてSkipDefaultTransaction:trueだと30%もパフォーマンスが上がるというがその設定はtrueにしていいいのか? っていうか、DefaultTransactionって何？ロールバックの単位とかどうやって指定するの? 確認&検証 検証時に作成したソースはgithub.com/lunarxlark/gorm2-tx
Context Gorm 2.0 #Context
GormはContextサポートを提供し、それを使いたかったらWithContext使ってくれ。 また、Sessionには単セッションモードと継続セッションモードがある。 普通は、継続セッションモードを使って、複数オペレーションをまとめるよ。 …GormのSessionってどんなことできるの?
Session Gorm 2.0 #Session
Gormは`Session`メソッドをを通して、新しいセッションを提供するよ。 新しいセッションを作る場合、設定がたくさんあるよ。DryRunやLoggerとかね。 …新しいセッションを一々作るのは望んでない。
Contextサポートしてくれるってことなのでgin.Contextへ埋め込む時にセッションを作成してそれを使い回したい。
gorm.WithContextのreturnはdb.Sessionとなっている(下記はgormのソースから抜粋)ので、gin.Contextへ埋め込むだけで新たにセッションを作る必要はない。
1 2 3 4 // WithContext change current instance db's context to ctx func (db *DB) WithContext(ctx context.Context) *DB { return db.Session(&amp;Session{Context: ctx}) } ここまでで下記みたいな感じになる。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 func main() { //... r := gin.New() r.Use(DBSession()) //... } func DBSession() gin.HandlerFunc { return func(c *gin.Context) { c.Set("DB", infra.RDB.WithContext(c)) c.Next() } } var RDB *gorm.DB var dsnWriter = "host=writer user=postgres port=5432 dbname=testDB password=pass sslmode=disable" var dsnReader = "host=reader user=postgres port=5432 dbname=testDB password=pass sslmode=disable" func DbOpen() error { var err error RDB, err = gorm.Open( postgres.New(postgres.Config{ DSN: dsnWriter, }), ) if err != nil { return err } RDB.Use(dbresolver.Register(dbresolver.Config{ Sources: []gorm.Dialector{postgres.Open(dsnWriter)}, Replicas: []gorm.Dialector{postgres.Open(dsnReader)}, })) return nil } Transaction Gorm 2.0 #Transaction
...</p></div><footer class=entry-footer><span title='2021-09-12 00:00:00 +0000 UTC'>2021年9月12日</span>&nbsp;·&nbsp;<span>2 分</span></footer><a class=entry-link aria-label="post link to gin + gorm v2でのセッションやトランザクション" href=https://lunarxlark.github.io/articles/20210912_gin_gormv2/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Go Code Review Comments (2021年時点)</h2></header><div class=entry-content><p>原典 Go Code Review Comments
動機 新しいチームメンバーに、Go の文化を知ってもらう一環として。 (GitHub や Twitter で指摘してもらえると直します。)
以下、訳。
Go Code Review Comments 略語で一つの詳細な説明まで辿り着けるように、このページでは Go のコードをレビューしている間に作られた多くの意見を集めました。 このページはよくある間違えのリストであって、包括的なスタイルガイドではありません。
Effective Goを補足として参照するとよいです。
小さな変更であっても、このページを編集する際は[変更内容を議論してください](https://github.com/golang/go/wiki/CodeReviewComments)。 多くの人が意見を持っていて、このページは編集戦争をする場ではありません。
Gofmt Comment Sentences Contexts Copying Crypto Rand Declaring Empty Slices Doc Comments Don’t Panic Error Strings Examples Goroutine Lifetimes Handle Errors Imports Import Blank Import Dot In-Band Errors Indent Error Flow Initialisms Interfaces Line Length Mixed Caps Named Result Parameters Naked Returns Package Comments Package Names Pass Values Receiver Names Receiver Type Synchronous Functions Useful Test Failures Variable Names Gofmt</p></div><footer class=entry-footer><span title='2021-08-23 00:00:00 +0000 UTC'>2021年8月23日</span>&nbsp;·&nbsp;<span>1 分</span></footer><a class=entry-link aria-label="post link to Go Code Review Comments (2021年時点)" href=https://lunarxlark.github.io/articles/20210823_gocodereviewcomments-jp/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>2021年版 vim + goplsの設定</h2></header><div class=entry-content><p>goplsが出てから, vimでも定義ジャンプやシンボル検索、ドキュメント参照等が行えるようになった。
たまにVSCodeを触りvimでの作業を改善できないか考える中で、自身の設定が古いことに気付いた。また、ググってもなかなか出てこなかったのでメモとして記述する。
cf. GitHub dotfiles
いきなりだが、vimrcとvim-lsp-settings/settings.jsonを抜粋して貼り付ける。
以前、GoではLspCodeAction, LspCodeLens等をサポートしていなかったが、今では使えるようになっている。
キーマップに設定している関数は全てGoで使用出来る。
ただし、カーソルがどこにいても実行出来るわけではないので注意が必要。
LspCodeActionはカーソルの位置によって実行内容が変わるのでそこも注意。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 ... Plug 'prabirshrestha/vim-lsp' Plug 'mattn/vim-lsp-settings' Plug 'prabirshrestha/asyncomplete-lsp.vim' Plug 'mattn/vim-gomod' ... " ------------------------------------------------------------------------------ " vim-lsp " ------------------------------------------------------------------------------ function! s:on_lsp_buffer_enabled() abort setlocal omnifunc=lsp#complete setlocal signcolumn=yes if exists('+tagfunc') | setlocal tagfunc=lsp#tagfunc | endif nmap &lt;buffer> &lt;leader>ac &lt;plug>(lsp-code-action) nmap &lt;buffer> &lt;leader>cl &lt;plug>(lsp-code-lens) nmap &lt;buffer> &lt;leader>df &lt;plug>(lsp-definition) nmap &lt;buffer> &lt;leader>dd &lt;plug>(lsp-document-diagnostics) nmap &lt;buffer> &lt;leader>im &lt;plug>(lsp-implementation) nmap &lt;buffer> &lt;leader>pdf &lt;plug>(lsp-peek-definition) nmap &lt;buffer> &lt;leader>sm &lt;plug>(lsp-document-symbol-search) nmap &lt;buffer> &lt;leader>Sm &lt;plug>(lsp-workspace-symbol-search) nmap &lt;buffer> &lt;leader>rf &lt;plug>(lsp-references) nmap &lt;buffer> &lt;leader>td &lt;plug>(lsp-type-definition) nmap &lt;buffer> &lt;leader>rn &lt;plug>(lsp-rename) nmap &lt;buffer> &lt;leader>en &lt;plug>(lsp-next-error) nmap &lt;buffer> &lt;leader>ep &lt;plug>(lsp-previous-error) nmap &lt;buffer> &lt;leader>ho &lt;plug>(lsp-hover) let g:lsp_format_sync_timeout = 500 autocmd! BufWritePre *.rs,*.go call execute('LspDocumentFormatSync') " refer to doc to add more commands endfunction augroup lsp_install au! " call s:on_lsp_buffer_enabled only for languages that has the server registered. autocmd User lsp_buffer_enabled call s:on_lsp_buffer_enabled() augroup END 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // vim-lsp-settings/settings.json { "go": { "gopls": { "initialization_options": { "analyses" : {"fillstruct":true}, "staticcheck": true, "directoryFilters": [ "-debug" ], "completeUnimported": true, "usePlaceholders": true, "matcher": "fuzzy", "codelenses": { "gc_details": false, "generate": true, "test": true, "tidy": true, "vendor": false }, "hoverKind": "SynopsisDocumentation" } } } } vim + goplsで新しく設定したこと LspCodeAction vim-lspのhelpにあるように、LspCodeActionが実行出来る行では A> が表示される。
...</p></div><footer class=entry-footer><span title='2021-06-16 00:00:00 +0000 UTC'>2021年6月16日</span>&nbsp;·&nbsp;<span>2 分</span></footer><a class=entry-link aria-label="post link to 2021年版 vim + goplsの設定" href=https://lunarxlark.github.io/articles/20210616_2021vim_gopls/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>load test with dynamic payload by tsenart/vegeta</h2></header><div class=entry-content><p>負荷テストツールvegetaのコマンドでの使い方ぐはググるとたくさん出てくるが、ライブラリとして仕様している記事が少なく手こずったのでメモ代わりに記事にする。
やりたいこと リクエスト毎にRequestの内容を動的に変えて、負荷をかけたかった。
Headerに持つタイムスタンプがリクエスト時のタイムスタンプになるように。 userIdはuniqueになるように。(同じユーザだと重複リクエストを弾く処理があったため。) 具体的には下記のような感じでリクエストを送りたい。
1 2 3 4 5 {"header": {"timestamp":"1234"}, "body": {"userId": "lunar-1"}} {"header": {"timestamp":"1234"}, "body": {"userId": "lunar-2"}} {"header": {"timestamp":"1235"}, "body": {"userId": "lunar-3"}} ... {"header": {"timestamp":"1240"}, "body": {"userId": "lunar-n"}} vegeta.Targeterは func(*vegeta.Target) error である。
また、vegeta.Attackは、vegeta.Targeterをgoroutineで都度呼び出して、Targeter内からTargetに基づきリクエストしていることから、都度Targetが変わるようなTargeterを返す関数を作成し、それをAttack時に呼び出せば良さそう。
ってことが、 [QUESTION] Sending requests with dynamic body #330に書いてあって何度も行き来した結果やっと理解できた…。
上記を拝借して以下のようにすることで目的を達成できた。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 type yourRequestBody struct { UserID string } targeter := func(id uint64) vegeta.Targeter { return func(t *vegeta.Target) error { execTime := time.Now() requestTimestamp := execTime.Unix() req := &amp;http.Request{ Method: "POST", URL: &amp;url.URL{ Scheme: "http", Host: "localhost", Path: "api/v1/yourendpoint/", }, Header: map[string][]string{ "X-RequestTimestamp": []string{strconv.Itoa(int(requestTimestamp))}, }, } t.Header = req.Header t.Method = req.Method t.URL = req.URL.String() t.Body, _ = json.Marshal( &amp;yourRequestBody{ UserID: fmt.Sprintf("lunar-%d-%d", requestTimestamp, atomic.AddUint64(&amp;id, 1)), }, ) return nil } }(0) rate := vegeta.Rate{Freq: 10, Per: time.Second} duration := 10 * time.Second var metrics vegeta.Metrics attacker := vegeta.NewAttacker() for res := range attacker.Attack(targeter, rate, duration, "Big Bang!") { metrics.Add(res) } 結構、苦戦した…。</p></div><footer class=entry-footer><span title='2021-03-11 00:00:00 +0000 UTC'>2021年3月11日</span>&nbsp;·&nbsp;<span>1 分</span></footer><a class=entry-link aria-label="post link to load test with dynamic payload by tsenart/vegeta" href=https://lunarxlark.github.io/articles/20210311_vegeta-dynamic-payload/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Custome Logger using LoggerWithConfig in Echo</h2></header><div class=entry-content><p>WebFramework EchoのLoggerを弄っていて気付いた点があったのでメモ。
sample code
箇条書き responseログにHeader X-Any-Headerを出力したい場合、ログフォーマットに"any_header":${header:x-any-header}を指定すればいいよ responseログにQueryParamerter ?anyparam=xxxを出力したい場合、ログフォーマットに"any_query":${query:anyparam}を指定すればいいよ デフォルトで出力されるカラム’id’はHeader X-Request-Id を指定すると出力されるよ Skipperを設定することで、path毎にログ出力する/しない等を設定出来るよ 1, 2, 3はEchoのそういう機能だってことで特にありません。 4は結構便利だなと思いました。以下のサンプルコードでは、/healthcheckに来た場合とCI/CD等での自動テスト時にはresponseログを出力しないようにする設定例です。
sample 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 // Middleware e.Use(middleware.LoggerWithConfig(customLogger())) // Handler e.GET("/greet", greet) e.GET("/healthcheck", healthcheck) var ResponseLogForamt = `{` + `"time":"${time_custom}",` + `"id":"${id}",` + `"remote_ip":"${remote_ip}",` + `"host":"${host}",` + `"method":"${method}",` + `"uri":"${uri}",` + `"user_agent":"${user_agent}",` + `"status":${status},` + `"error":"${error}",` + `"latency":${latency},` + `"latency_human":"${latency_human}",` + `"bytes_in":${bytes_in},` + `"bytes_out":${bytes_out},` + `"forwarded-for":"${header:x-forwarded-for}",` + `"same-as-id":${header:X-Request-Id},` + `"query":${query:lang}` + `}` func customLogger() middleware.LoggerConfig { cl := middleware.DefaultLoggerConfig cl.Skipper = customeSkipper cl.Format = ResponseLogForamt cl.CustomTimeFormat = "2006/01/02 15:04:05.00000" return cl } func customeSkipper(c echo.Context) bool { if c.Path() == "/healthcheck" { return true } if os.Getenv("ENV") == "auto-test" { return true } else { return false } } func greet(c echo.Context) error { switch c.QueryParam("lang") { case "jp": return c.String(http.StatusOK, "こんにちは\n") case "en": return c.String(http.StatusOK, "Hello World\n") default: return c.String(http.StatusOK, "ウホホイ!!\n") } } func healthcheck(c echo.Context) error { return c.String(http.StatusOK, "I'm fine\n") } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 -- request $ curl \ -X GET \ -H "X-Forwarded-For: achoo" \ -H "X-Request-Id: requestid123" \ "http://localhost/greet?lang=en" -- response log { "time":"2020/11/10 00:17:09.28534", "id":"requestid123", "remote_ip":"achoo", "host":"localhost", "method":"GET", "uri":"/greet?lang=en", "user_agent":"curl/7.64.1", "status":200, "error":"", "latency":18699, "latency_human":"18.699µs", "bytes_in":0, "bytes_out":12, "forwarded-for":"achoo", "same-as-id":requestid123, "query":en }</p></div><footer class=entry-footer><span title='2020-11-10 02:51:09 +0900 +0900'>2020年11月10日</span>&nbsp;·&nbsp;<span>2 分</span></footer><a class=entry-link aria-label="post link to Custome Logger using LoggerWithConfig in Echo" href=https://lunarxlark.github.io/articles/20201110_echo-custom-logger/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>自分用日本語訳 Go Module</h2></header><div class=entry-content><p>(この記事は、執筆時点でのGo Modulesをもとにした私のメモです。Go Moduleの理解のために、元記事と記載の順番が入れ替わっている項目もあります。)
...</p></div><footer class=entry-footer><span title='2020-05-14 00:00:00 +0000 UTC'>2020年5月14日</span>&nbsp;·&nbsp;<span>2 分</span></footer><a class=entry-link aria-label="post link to 自分用日本語訳 Go Module" href=https://lunarxlark.github.io/articles/20200514_go-module-jpn/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>My Favorite Usage urfave/cli</h2></header><div class=entry-content><p>参加しているプロジェクトでurfave/cliを使っている。使い方はExampleにあるのと同じ書き方で使っている。 大半のバッチ処理をコマンドとして記述しているので、Exampleの書き方だとだいぶ見辛くなってきた。縦長のコマンド定義とオプション説明で目的の処理を探すのにもページ送りを何度もする。なんとかしたい。
...</p></div><footer class=entry-footer><span title='2020-02-06 00:00:00 +0000 UTC'>2020年2月6日</span>&nbsp;·&nbsp;<span>1 分</span></footer><a class=entry-link aria-label="post link to My Favorite Usage urfave/cli" href=https://lunarxlark.github.io/articles/20200206_my-favorite-usage-urfave-cli/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Error 'undefined' when go run</h2></header><div class=entry-content><p>x…motemen/ghqを写経している時、 go run main.go 出来ないことに気付いた。 下記が実行時のエラーになる。ちなみに、 go build は出来る。
1 2 3 4 ~/d/s/g/x/ghq >>> go run main.go # command-line-arguments ./main.go:38:17: undefined: commands ~/d/s/g/x/ghq >>> commands が見つからない？同じ階層の commands.go には下記記述がちゃんとあるのに、どうして見つからない…。
1 2 3 4 5 6 var commands = []*cli.Command{ commandGet, commandList, commandRoot, commandCreate, } 理由は、go runの引数に指定したファイル(+ importされるパッケージ)しか読み込まないから。
...</p></div><footer class=entry-footer><span title='2020-02-04 00:00:00 +0000 UTC'>2020年2月4日</span>&nbsp;·&nbsp;<span>1 分</span></footer><a class=entry-link aria-label="post link to Error 'undefined' when go run" href=https://lunarxlark.github.io/articles/20200204_how-to-go-run/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://lunarxlark.github.io/>/home/lunarxlark/.config/blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>