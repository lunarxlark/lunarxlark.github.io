<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Go | /home/lunarxlark/.config/blog</title><meta name=keywords content><meta name=description content><meta name=author content><link rel=canonical href=https://lunarxlark.github.io/tags/go/><link crossorigin=anonymous href=/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn+yY=" rel="preload stylesheet" as=style><link rel=icon href=https://lunarxlark.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lunarxlark.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lunarxlark.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://lunarxlark.github.io/apple-touch-icon.png><link rel=mask-icon href=https://lunarxlark.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://lunarxlark.github.io/tags/go/index.xml title=rss><link rel=alternate hreflang=ja href=https://lunarxlark.github.io/tags/go/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-HC9218ZECN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HC9218ZECN")}</script><meta property="og:url" content="https://lunarxlark.github.io/tags/go/"><meta property="og:site_name" content="/home/lunarxlark/.config/blog"><meta property="og:title" content="Go"><meta property="og:locale" content="ja"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go"><meta name=twitter:description content></head><body class="list dark" id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lunarxlark.github.io/ accesskey=h title="/home/lunarxlark/.config/blog (Alt + H)">/home/lunarxlark/.config/blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lunarxlark.github.io/ title=Home><span>Home</span></a></li><li><a href=https://lunarxlark.github.io/about title=About><span>About</span></a></li><li><a href=https://lunarxlark.github.io/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>Go</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Neovim + DAP + Go</h2></header><div class=entry-content><p>TL;DR DAP(Debug Adapter Protocol)ã®åŠ›ã‚’å€Ÿã‚Šã‚Œã°ã€Neovimä¸Šã§ã‚‚è¦–è¦šçš„ã«Goã®ãƒ‡ãƒãƒƒã‚°ãŒå‡ºæ¥ã¾ã—ãŸã€‚ ã“ã“ã§ã¯ä¸‹è¨˜ã«ã¤ã„ã¦ã¯è©±ã—ã¾ã›ã‚“ã€‚
DAPã®è©³ç´° packer.nvimã§ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• vscode-goã®debugAdapter.jsã®ä½¿ç”¨æ–¹æ³• Neovimã§ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ v0.2.2ã‹ã‚‰è‰²ã€…å¤‰ã‚ã£ãŸNeovimã‚’ä¹…ã€…ã«è§¦ã£ã¦ã¿ã‚ˆã†ã‹ã¨æ€ã„init.luaã¸ä»¥é™ã—ã¦éŠã‚“ã§ã„ã¾ã—ãŸã€‚ èµ·å‹•ãŒæ—©ã„ã ã‘ã§ãªãã€LSPç³»ã®å‹•ä½œã‚‚ã‚µã‚¯ã‚µã‚¯å‹•ã„ã¦ã“ã“2ãƒ¶æœˆç¨‹å¿«é©ã«éã”ã—ã¦ã„ã¾ã™ã€‚
ãŸã ã€VSCodeã§ã®ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãŒã¨ã¦ã‚‚ä¾¿åˆ©ãªãŸã‚ã€ãƒ‡ãƒãƒƒã‚¬ä½¿ç”¨æ™‚ã®ã¿ã“ã®å¿«é©ãªç’°å¢ƒã‚’é›¢ã‚Œã¦ã„ã¾ã—ãŸã€‚
ã©ã†ã«ã‹Neovimä¸Šã§å®Œçµã•ã›ã‚‰ã‚Œãªã„ã‹â€¦ã€‚
DAP DAPã®èª¬æ˜ã¯ãƒªãƒ³ã‚¯å…ˆã‚„ä»–HPã‚’ã”å‚ç…§ãã ã•ã„ã€‚
ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒã£ã¦ã‚‚ã‚‰ã†ãŸã‚LSPã‚’å¼•ãåˆã„ã«å‡ºã™ã¨ã€LSPãŒãƒ†ã‚­ã‚¹ãƒˆç·¨é›†æ™‚ã«å®šç¾©ã‚„å¤‰æ›´å†…å®¹ã‚„è£œå®Œå€™è£œç­‰ã‚’è¿”ã™ã®ã«å¯¾ã—ã¦ã€DAPã¯ãƒ‡ãƒãƒƒã‚¬ã¨ã‚„ã‚Šã¨ã‚Šã—ã¦ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¿”ã™ä½ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒã£ã¦ã‚‚ã‚‰ãˆã‚Œã°å¤§ä¸ˆå¤«ã ã¨æ€ã„ã¾ã™ã€‚
Neovim + DAP + Go ä½¿ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚
mfussenegger/nvim-dap : Neovimã®DAPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€‚VSCodeã®launch.jsonã‚‚ä½¿ç”¨å¯ rcarriga/nvim-dap-ui : nvim-dapã‚’è¦–è¦šçš„ã«æ“ä½œã—ã‚„ã™ã„UI leoluz/nvim-dap-go : DAPã®Goç”¨è¨­å®š(delve dapèµ·å‹•) nvim-treesitter/nvim-treesitter nvim-dap-goã§ãƒ†ã‚¹ãƒˆã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹éš›ã€è¿‘ãã®ãƒ†ã‚¹ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã®ã«å¿…è¦ packer.nvimã®è¨­å®š VSCodeã®launch.jsonã‚’ä½¿ç”¨ã—ãªã„å ´åˆã€require('dap.ext.vscode').load_launchjs()ã¯ä¸è¦ã§ã™ã€‚ launch.jsonã‚’èª­ã¿è¾¼ã‚ãŸå ´åˆã€ãƒ‡ãƒãƒƒã‚°æ–¹æ³•ã®é¸æŠæ™‚ã«launch.jsonã®å†…å®¹ãŒè¿½åŠ è¡¨ç¤ºã•ã‚Œã¦é¸æŠå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 -- dap plugin installation with packer.nvim ... -- dap use { "rcarriga/nvim-dap-ui", requires = { "mfussenegger/nvim-dap", "leoluz/nvim-dap-go", "nvim-treesitter/nvim-treesitter" }, config = function () vim.fn.sign_define('DapBreakpoint', {text='â›”', texthl='', linehl='', numhl=''}) vim.fn.sign_define('DapStopped', {text='ğŸ‘‰', texthl='', linehl='', numhl=''}) require('dapui').setup() require('dap-go').setup() require('dap.ext.vscode').load_launchjs() end } ... Goã§DAPã‚’èµ·å‹•ã™ã‚‹éš›ã®è¨­å®š Goã®å ´åˆã€vscode-goã®debugAdapter.jsã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚ã“ã“ã§ã¯ã€delveã‚’å¾…ã¡æ§‹ãˆã•ã›ã¾ã™ã€‚
...</p></div><footer class=entry-footer><span title='2021-11-24 00:00:00 +0000 UTC'>2021å¹´11æœˆ24æ—¥</span>&nbsp;Â·&nbsp;<span>3 åˆ†</span></footer><a class=entry-link aria-label="post link to Neovim + DAP + Go" href=https://lunarxlark.github.io/articles/20211124_nvim-dap-go/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>gin + gorm v2ã§ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚„ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³</h2></header><div class=entry-content><p>TL;DR ginã§ã®å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’1ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ç®¡ç†ã—ã¤ã¤ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚‚ç®¡ç†ã—ãŸã„ã€‚
ginã®middlewareã§ã€gin.Contextã«gorm.WithContextã‚’ç”¨ã„ã¦Gormã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æŒãŸã›ã‚‹ã€‚ ginã®å„HandlerFuncã®ä¸­ã§ã¯ã€gin.Contextå†…ã®Gormã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰DBã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚ ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ Gormã¯v2ã«ãªã‚Šè‰²ã€…ã¨å¤‰ã‚ã£ãŸã€‚ Gorm 2.0 Release Note
è‰²ã€…ãªè¨˜äº‹ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ãŒTransactoinã«é–¢ã—ã¦ã‚ã¾ã‚Šæ›¸ã‹ã‚Œã¦ã„ãªã„ã€‚
ä¸‹è¨˜ç–‘å•ã‚’æ‰•æ‹­ã—ã¦æ­£ã—ã„ä½¿ã„æ–¹ã‚’è‡ªåˆ†ãªã‚Šã«ç¢ºã‹ã‚ãŸã‹ã£ãŸã®ã§è©¦ã—ãŸã€‚
ãªã‚“ã¨ãªãå‹•ããŒã“ã‚Œã§æ­£ã—ã„ã®ã‹? ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ã„ã¦SkipDefaultTransaction:trueã ã¨30%ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä¸ŠãŒã‚‹ã¨ã„ã†ãŒãã®è¨­å®šã¯trueã«ã—ã¦ã„ã„ã„ã®ã‹? ã£ã¦ã„ã†ã‹ã€DefaultTransactionã£ã¦ä½•ï¼Ÿãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®å˜ä½ã¨ã‹ã©ã†ã‚„ã£ã¦æŒ‡å®šã™ã‚‹ã®? ç¢ºèª&æ¤œè¨¼ æ¤œè¨¼æ™‚ã«ä½œæˆã—ãŸã‚½ãƒ¼ã‚¹ã¯github.com/lunarxlark/gorm2-tx
Context Gorm 2.0 #Context
Gormã¯Contextã‚µãƒãƒ¼ãƒˆã‚’æä¾›ã—ã€ãã‚Œã‚’ä½¿ã„ãŸã‹ã£ãŸã‚‰WithContextä½¿ã£ã¦ãã‚Œã€‚ ã¾ãŸã€Sessionã«ã¯å˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰ã¨ç¶™ç¶šã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚‹ã€‚ æ™®é€šã¯ã€ç¶™ç¶šã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã€è¤‡æ•°ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¾ã¨ã‚ã‚‹ã‚ˆã€‚ â€¦Gormã®Sessionã£ã¦ã©ã‚“ãªã“ã¨ã§ãã‚‹ã®?
Session Gorm 2.0 #Session
Gormã¯`Session`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚’é€šã—ã¦ã€æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æä¾›ã™ã‚‹ã‚ˆã€‚ æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹å ´åˆã€è¨­å®šãŒãŸãã•ã‚“ã‚ã‚‹ã‚ˆã€‚DryRunã‚„Loggerã¨ã‹ã­ã€‚ â€¦æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¸€ã€…ä½œã‚‹ã®ã¯æœ›ã‚“ã§ãªã„ã€‚
Contextã‚µãƒãƒ¼ãƒˆã—ã¦ãã‚Œã‚‹ã£ã¦ã“ã¨ãªã®ã§gin.Contextã¸åŸ‹ã‚è¾¼ã‚€æ™‚ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ãã‚Œã‚’ä½¿ã„å›ã—ãŸã„ã€‚
gorm.WithContextã®returnã¯db.Sessionã¨ãªã£ã¦ã„ã‚‹(ä¸‹è¨˜ã¯gormã®ã‚½ãƒ¼ã‚¹ã‹ã‚‰æŠœç²‹)ã®ã§ã€gin.Contextã¸åŸ‹ã‚è¾¼ã‚€ã ã‘ã§æ–°ãŸã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹å¿…è¦ã¯ãªã„ã€‚
1 2 3 4 // WithContext change current instance db's context to ctx func (db *DB) WithContext(ctx context.Context) *DB { return db.Session(&amp;Session{Context: ctx}) } ã“ã“ã¾ã§ã§ä¸‹è¨˜ã¿ãŸã„ãªæ„Ÿã˜ã«ãªã‚‹ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 func main() { //... r := gin.New() r.Use(DBSession()) //... } func DBSession() gin.HandlerFunc { return func(c *gin.Context) { c.Set("DB", infra.RDB.WithContext(c)) c.Next() } } var RDB *gorm.DB var dsnWriter = "host=writer user=postgres port=5432 dbname=testDB password=pass sslmode=disable" var dsnReader = "host=reader user=postgres port=5432 dbname=testDB password=pass sslmode=disable" func DbOpen() error { var err error RDB, err = gorm.Open( postgres.New(postgres.Config{ DSN: dsnWriter, }), ) if err != nil { return err } RDB.Use(dbresolver.Register(dbresolver.Config{ Sources: []gorm.Dialector{postgres.Open(dsnWriter)}, Replicas: []gorm.Dialector{postgres.Open(dsnReader)}, })) return nil } Transaction Gorm 2.0 #Transaction
...</p></div><footer class=entry-footer><span title='2021-09-12 00:00:00 +0000 UTC'>2021å¹´9æœˆ12æ—¥</span>&nbsp;Â·&nbsp;<span>2 åˆ†</span></footer><a class=entry-link aria-label="post link to gin + gorm v2ã§ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚„ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³" href=https://lunarxlark.github.io/articles/20210912_gin_gormv2/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Go Code Review Comments (2021å¹´æ™‚ç‚¹)</h2></header><div class=entry-content><p>åŸå…¸ Go Code Review Comments
å‹•æ©Ÿ æ–°ã—ã„ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«ã€Go ã®æ–‡åŒ–ã‚’çŸ¥ã£ã¦ã‚‚ã‚‰ã†ä¸€ç’°ã¨ã—ã¦ã€‚ (GitHub ã‚„ Twitter ã§æŒ‡æ‘˜ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ç›´ã—ã¾ã™ã€‚)
ä»¥ä¸‹ã€è¨³ã€‚
Go Code Review Comments ç•¥èªã§ä¸€ã¤ã®è©³ç´°ãªèª¬æ˜ã¾ã§è¾¿ã‚Šç€ã‘ã‚‹ã‚ˆã†ã«ã€ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ Go ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã„ã‚‹é–“ã«ä½œã‚‰ã‚ŒãŸå¤šãã®æ„è¦‹ã‚’é›†ã‚ã¾ã—ãŸã€‚ ã“ã®ãƒšãƒ¼ã‚¸ã¯ã‚ˆãã‚ã‚‹é–“é•ãˆã®ãƒªã‚¹ãƒˆã§ã‚ã£ã¦ã€åŒ…æ‹¬çš„ãªã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
Effective Goã‚’è£œè¶³ã¨ã—ã¦å‚ç…§ã™ã‚‹ã¨ã‚ˆã„ã§ã™ã€‚
å°ã•ãªå¤‰æ›´ã§ã‚ã£ã¦ã‚‚ã€ã“ã®ãƒšãƒ¼ã‚¸ã‚’ç·¨é›†ã™ã‚‹éš›ã¯[å¤‰æ›´å†…å®¹ã‚’è­°è«–ã—ã¦ãã ã•ã„](https://github.com/golang/go/wiki/CodeReviewComments)ã€‚ å¤šãã®äººãŒæ„è¦‹ã‚’æŒã£ã¦ã„ã¦ã€ã“ã®ãƒšãƒ¼ã‚¸ã¯ç·¨é›†æˆ¦äº‰ã‚’ã™ã‚‹å ´ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
Gofmt Comment Sentences Contexts Copying Crypto Rand Declaring Empty Slices Doc Comments Donâ€™t Panic Error Strings Examples Goroutine Lifetimes Handle Errors Imports Import Blank Import Dot In-Band Errors Indent Error Flow Initialisms Interfaces Line Length Mixed Caps Named Result Parameters Naked Returns Package Comments Package Names Pass Values Receiver Names Receiver Type Synchronous Functions Useful Test Failures Variable Names Gofmt</p></div><footer class=entry-footer><span title='2021-08-23 00:00:00 +0000 UTC'>2021å¹´8æœˆ23æ—¥</span>&nbsp;Â·&nbsp;<span>1 åˆ†</span></footer><a class=entry-link aria-label="post link to Go Code Review Comments (2021å¹´æ™‚ç‚¹)" href=https://lunarxlark.github.io/articles/20210823_gocodereviewcomments-jp/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>2021å¹´ç‰ˆ vim + goplsã®è¨­å®š</h2></header><div class=entry-content><p>goplsãŒå‡ºã¦ã‹ã‚‰, vimã§ã‚‚å®šç¾©ã‚¸ãƒ£ãƒ³ãƒ—ã‚„ã‚·ãƒ³ãƒœãƒ«æ¤œç´¢ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ç­‰ãŒè¡Œãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
ãŸã¾ã«VSCodeã‚’è§¦ã‚Švimã§ã®ä½œæ¥­ã‚’æ”¹å–„ã§ããªã„ã‹è€ƒãˆã‚‹ä¸­ã§ã€è‡ªèº«ã®è¨­å®šãŒå¤ã„ã“ã¨ã«æ°—ä»˜ã„ãŸã€‚ã¾ãŸã€ã‚°ã‚°ã£ã¦ã‚‚ãªã‹ãªã‹å‡ºã¦ã“ãªã‹ã£ãŸã®ã§ãƒ¡ãƒ¢ã¨ã—ã¦è¨˜è¿°ã™ã‚‹ã€‚
cf. GitHub dotfiles
ã„ããªã‚Šã ãŒã€vimrcã¨vim-lsp-settings/settings.jsonã‚’æŠœç²‹ã—ã¦è²¼ã‚Šä»˜ã‘ã‚‹ã€‚
ä»¥å‰ã€Goã§ã¯LspCodeAction, LspCodeLensç­‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã‹ã£ãŸãŒã€ä»Šã§ã¯ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚
ã‚­ãƒ¼ãƒãƒƒãƒ—ã«è¨­å®šã—ã¦ã„ã‚‹é–¢æ•°ã¯å…¨ã¦Goã§ä½¿ç”¨å‡ºæ¥ã‚‹ã€‚
ãŸã ã—ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒã©ã“ã«ã„ã¦ã‚‚å®Ÿè¡Œå‡ºæ¥ã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§æ³¨æ„ãŒå¿…è¦ã€‚
LspCodeActionã¯ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®ã«ã‚ˆã£ã¦å®Ÿè¡Œå†…å®¹ãŒå¤‰ã‚ã‚‹ã®ã§ãã“ã‚‚æ³¨æ„ã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 ... Plug 'prabirshrestha/vim-lsp' Plug 'mattn/vim-lsp-settings' Plug 'prabirshrestha/asyncomplete-lsp.vim' Plug 'mattn/vim-gomod' ... " ------------------------------------------------------------------------------ " vim-lsp " ------------------------------------------------------------------------------ function! s:on_lsp_buffer_enabled() abort setlocal omnifunc=lsp#complete setlocal signcolumn=yes if exists('+tagfunc') | setlocal tagfunc=lsp#tagfunc | endif nmap &lt;buffer> &lt;leader>ac &lt;plug>(lsp-code-action) nmap &lt;buffer> &lt;leader>cl &lt;plug>(lsp-code-lens) nmap &lt;buffer> &lt;leader>df &lt;plug>(lsp-definition) nmap &lt;buffer> &lt;leader>dd &lt;plug>(lsp-document-diagnostics) nmap &lt;buffer> &lt;leader>im &lt;plug>(lsp-implementation) nmap &lt;buffer> &lt;leader>pdf &lt;plug>(lsp-peek-definition) nmap &lt;buffer> &lt;leader>sm &lt;plug>(lsp-document-symbol-search) nmap &lt;buffer> &lt;leader>Sm &lt;plug>(lsp-workspace-symbol-search) nmap &lt;buffer> &lt;leader>rf &lt;plug>(lsp-references) nmap &lt;buffer> &lt;leader>td &lt;plug>(lsp-type-definition) nmap &lt;buffer> &lt;leader>rn &lt;plug>(lsp-rename) nmap &lt;buffer> &lt;leader>en &lt;plug>(lsp-next-error) nmap &lt;buffer> &lt;leader>ep &lt;plug>(lsp-previous-error) nmap &lt;buffer> &lt;leader>ho &lt;plug>(lsp-hover) let g:lsp_format_sync_timeout = 500 autocmd! BufWritePre *.rs,*.go call execute('LspDocumentFormatSync') " refer to doc to add more commands endfunction augroup lsp_install au! " call s:on_lsp_buffer_enabled only for languages that has the server registered. autocmd User lsp_buffer_enabled call s:on_lsp_buffer_enabled() augroup END 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // vim-lsp-settings/settings.json { "go": { "gopls": { "initialization_options": { "analyses" : {"fillstruct":true}, "staticcheck": true, "directoryFilters": [ "-debug" ], "completeUnimported": true, "usePlaceholders": true, "matcher": "fuzzy", "codelenses": { "gc_details": false, "generate": true, "test": true, "tidy": true, "vendor": false }, "hoverKind": "SynopsisDocumentation" } } } } vim + goplsã§æ–°ã—ãè¨­å®šã—ãŸã“ã¨ LspCodeAction vim-lspã®helpã«ã‚ã‚‹ã‚ˆã†ã«ã€LspCodeActionãŒå®Ÿè¡Œå‡ºæ¥ã‚‹è¡Œã§ã¯ A> ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚
...</p></div><footer class=entry-footer><span title='2021-06-16 00:00:00 +0000 UTC'>2021å¹´6æœˆ16æ—¥</span>&nbsp;Â·&nbsp;<span>2 åˆ†</span></footer><a class=entry-link aria-label="post link to 2021å¹´ç‰ˆ vim + goplsã®è¨­å®š" href=https://lunarxlark.github.io/articles/20210616_2021vim_gopls/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>load test with dynamic payload by tsenart/vegeta</h2></header><div class=entry-content><p>è² è·ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«vegetaã®ã‚³ãƒãƒ³ãƒ‰ã§ã®ä½¿ã„æ–¹ãã¯ã‚°ã‚°ã‚‹ã¨ãŸãã•ã‚“å‡ºã¦ãã‚‹ãŒã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦ä»•æ§˜ã—ã¦ã„ã‚‹è¨˜äº‹ãŒå°‘ãªãæ‰‹ã“ãšã£ãŸã®ã§ãƒ¡ãƒ¢ä»£ã‚ã‚Šã«è¨˜äº‹ã«ã™ã‚‹ã€‚
ã‚„ã‚ŠãŸã„ã“ã¨ ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¯ã«Requestã®å†…å®¹ã‚’å‹•çš„ã«å¤‰ãˆã¦ã€è² è·ã‚’ã‹ã‘ãŸã‹ã£ãŸã€‚
Headerã«æŒã¤ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã«ãªã‚‹ã‚ˆã†ã«ã€‚ userIdã¯uniqueã«ãªã‚‹ã‚ˆã†ã«ã€‚(åŒã˜ãƒ¦ãƒ¼ã‚¶ã ã¨é‡è¤‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å¼¾ãå‡¦ç†ãŒã‚ã£ãŸãŸã‚ã€‚) å…·ä½“çš„ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªæ„Ÿã˜ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚ŠãŸã„ã€‚
1 2 3 4 5 {"header": {"timestamp":"1234"}, "body": {"userId": "lunar-1"}} {"header": {"timestamp":"1234"}, "body": {"userId": "lunar-2"}} {"header": {"timestamp":"1235"}, "body": {"userId": "lunar-3"}} ... {"header": {"timestamp":"1240"}, "body": {"userId": "lunar-n"}} vegeta.Targeterã¯ func(*vegeta.Target) error ã§ã‚ã‚‹ã€‚
ã¾ãŸã€vegeta.Attackã¯ã€vegeta.Targeterã‚’goroutineã§éƒ½åº¦å‘¼ã³å‡ºã—ã¦ã€Targeterå†…ã‹ã‚‰Targetã«åŸºã¥ããƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€éƒ½åº¦TargetãŒå¤‰ã‚ã‚‹ã‚ˆã†ãªTargeterã‚’è¿”ã™é–¢æ•°ã‚’ä½œæˆã—ã€ãã‚Œã‚’Attackæ™‚ã«å‘¼ã³å‡ºã›ã°è‰¯ã•ãã†ã€‚
ã£ã¦ã“ã¨ãŒã€ [QUESTION] Sending requests with dynamic body #330ã«æ›¸ã„ã¦ã‚ã£ã¦ä½•åº¦ã‚‚è¡Œãæ¥ã—ãŸçµæœã‚„ã£ã¨ç†è§£ã§ããŸâ€¦ã€‚
ä¸Šè¨˜ã‚’æ‹å€Ÿã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ç›®çš„ã‚’é”æˆã§ããŸã€‚
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 type yourRequestBody struct { UserID string } targeter := func(id uint64) vegeta.Targeter { return func(t *vegeta.Target) error { execTime := time.Now() requestTimestamp := execTime.Unix() req := &amp;http.Request{ Method: "POST", URL: &amp;url.URL{ Scheme: "http", Host: "localhost", Path: "api/v1/yourendpoint/", }, Header: map[string][]string{ "X-RequestTimestamp": []string{strconv.Itoa(int(requestTimestamp))}, }, } t.Header = req.Header t.Method = req.Method t.URL = req.URL.String() t.Body, _ = json.Marshal( &amp;yourRequestBody{ UserID: fmt.Sprintf("lunar-%d-%d", requestTimestamp, atomic.AddUint64(&amp;id, 1)), }, ) return nil } }(0) rate := vegeta.Rate{Freq: 10, Per: time.Second} duration := 10 * time.Second var metrics vegeta.Metrics attacker := vegeta.NewAttacker() for res := range attacker.Attack(targeter, rate, duration, "Big Bang!") { metrics.Add(res) } çµæ§‹ã€è‹¦æˆ¦ã—ãŸâ€¦ã€‚</p></div><footer class=entry-footer><span title='2021-03-11 00:00:00 +0000 UTC'>2021å¹´3æœˆ11æ—¥</span>&nbsp;Â·&nbsp;<span>1 åˆ†</span></footer><a class=entry-link aria-label="post link to load test with dynamic payload by tsenart/vegeta" href=https://lunarxlark.github.io/articles/20210311_vegeta-dynamic-payload/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Custome Logger using LoggerWithConfig in Echo</h2></header><div class=entry-content><p>WebFramework Echoã®Loggerã‚’å¼„ã£ã¦ã„ã¦æ°—ä»˜ã„ãŸç‚¹ãŒã‚ã£ãŸã®ã§ãƒ¡ãƒ¢ã€‚
sample code
ç®‡æ¡æ›¸ã responseãƒ­ã‚°ã«Header X-Any-Headerã‚’å‡ºåŠ›ã—ãŸã„å ´åˆã€ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«"any_header":${header:x-any-header}ã‚’æŒ‡å®šã™ã‚Œã°ã„ã„ã‚ˆ responseãƒ­ã‚°ã«QueryParamerter ?anyparam=xxxã‚’å‡ºåŠ›ã—ãŸã„å ´åˆã€ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«"any_query":${query:anyparam}ã‚’æŒ‡å®šã™ã‚Œã°ã„ã„ã‚ˆ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‡ºåŠ›ã•ã‚Œã‚‹ã‚«ãƒ©ãƒ â€™idâ€™ã¯Header X-Request-Id ã‚’æŒ‡å®šã™ã‚‹ã¨å‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆ Skipperã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€pathæ¯ã«ãƒ­ã‚°å‡ºåŠ›ã™ã‚‹/ã—ãªã„ç­‰ã‚’è¨­å®šå‡ºæ¥ã‚‹ã‚ˆ 1, 2, 3ã¯Echoã®ãã†ã„ã†æ©Ÿèƒ½ã ã£ã¦ã“ã¨ã§ç‰¹ã«ã‚ã‚Šã¾ã›ã‚“ã€‚ 4ã¯çµæ§‹ä¾¿åˆ©ã ãªã¨æ€ã„ã¾ã—ãŸã€‚ä»¥ä¸‹ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯ã€/healthcheckã«æ¥ãŸå ´åˆã¨CI/CDç­‰ã§ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆæ™‚ã«ã¯responseãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãªã„ã‚ˆã†ã«ã™ã‚‹è¨­å®šä¾‹ã§ã™ã€‚
sample 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 // Middleware e.Use(middleware.LoggerWithConfig(customLogger())) // Handler e.GET("/greet", greet) e.GET("/healthcheck", healthcheck) var ResponseLogForamt = `{` + `"time":"${time_custom}",` + `"id":"${id}",` + `"remote_ip":"${remote_ip}",` + `"host":"${host}",` + `"method":"${method}",` + `"uri":"${uri}",` + `"user_agent":"${user_agent}",` + `"status":${status},` + `"error":"${error}",` + `"latency":${latency},` + `"latency_human":"${latency_human}",` + `"bytes_in":${bytes_in},` + `"bytes_out":${bytes_out},` + `"forwarded-for":"${header:x-forwarded-for}",` + `"same-as-id":${header:X-Request-Id},` + `"query":${query:lang}` + `}` func customLogger() middleware.LoggerConfig { cl := middleware.DefaultLoggerConfig cl.Skipper = customeSkipper cl.Format = ResponseLogForamt cl.CustomTimeFormat = "2006/01/02 15:04:05.00000" return cl } func customeSkipper(c echo.Context) bool { if c.Path() == "/healthcheck" { return true } if os.Getenv("ENV") == "auto-test" { return true } else { return false } } func greet(c echo.Context) error { switch c.QueryParam("lang") { case "jp": return c.String(http.StatusOK, "ã“ã‚“ã«ã¡ã¯\n") case "en": return c.String(http.StatusOK, "Hello World\n") default: return c.String(http.StatusOK, "ã‚¦ãƒ›ãƒ›ã‚¤!!\n") } } func healthcheck(c echo.Context) error { return c.String(http.StatusOK, "I'm fine\n") } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 -- request $ curl \ -X GET \ -H "X-Forwarded-For: achoo" \ -H "X-Request-Id: requestid123" \ "http://localhost/greet?lang=en" -- response log { "time":"2020/11/10 00:17:09.28534", "id":"requestid123", "remote_ip":"achoo", "host":"localhost", "method":"GET", "uri":"/greet?lang=en", "user_agent":"curl/7.64.1", "status":200, "error":"", "latency":18699, "latency_human":"18.699Âµs", "bytes_in":0, "bytes_out":12, "forwarded-for":"achoo", "same-as-id":requestid123, "query":en }</p></div><footer class=entry-footer><span title='2020-11-10 02:51:09 +0900 +0900'>2020å¹´11æœˆ10æ—¥</span>&nbsp;Â·&nbsp;<span>2 åˆ†</span></footer><a class=entry-link aria-label="post link to Custome Logger using LoggerWithConfig in Echo" href=https://lunarxlark.github.io/articles/20201110_echo-custom-logger/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>è‡ªåˆ†ç”¨æ—¥æœ¬èªè¨³ Go Module</h2></header><div class=entry-content><p>(ã“ã®è¨˜äº‹ã¯ã€åŸ·ç­†æ™‚ç‚¹ã§ã®Go Modulesã‚’ã‚‚ã¨ã«ã—ãŸç§ã®ãƒ¡ãƒ¢ã§ã™ã€‚Go Moduleã®ç†è§£ã®ãŸã‚ã«ã€å…ƒè¨˜äº‹ã¨è¨˜è¼‰ã®é †ç•ªãŒå…¥ã‚Œæ›¿ã‚ã£ã¦ã„ã‚‹é …ç›®ã‚‚ã‚ã‚Šã¾ã™ã€‚)
...</p></div><footer class=entry-footer><span title='2020-05-14 00:00:00 +0000 UTC'>2020å¹´5æœˆ14æ—¥</span>&nbsp;Â·&nbsp;<span>2 åˆ†</span></footer><a class=entry-link aria-label="post link to è‡ªåˆ†ç”¨æ—¥æœ¬èªè¨³ Go Module" href=https://lunarxlark.github.io/articles/20200514_go-module-jpn/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>My Favorite Usage urfave/cli</h2></header><div class=entry-content><p>å‚åŠ ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§urfave/cliã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚ä½¿ã„æ–¹ã¯Exampleã«ã‚ã‚‹ã®ã¨åŒã˜æ›¸ãæ–¹ã§ä½¿ã£ã¦ã„ã‚‹ã€‚ å¤§åŠã®ãƒãƒƒãƒå‡¦ç†ã‚’ã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦è¨˜è¿°ã—ã¦ã„ã‚‹ã®ã§ã€Exampleã®æ›¸ãæ–¹ã ã¨ã ã„ã¶è¦‹è¾›ããªã£ã¦ããŸã€‚ç¸¦é•·ã®ã‚³ãƒãƒ³ãƒ‰å®šç¾©ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³èª¬æ˜ã§ç›®çš„ã®å‡¦ç†ã‚’æ¢ã™ã®ã«ã‚‚ãƒšãƒ¼ã‚¸é€ã‚Šã‚’ä½•åº¦ã‚‚ã™ã‚‹ã€‚ãªã‚“ã¨ã‹ã—ãŸã„ã€‚
...</p></div><footer class=entry-footer><span title='2020-02-06 00:00:00 +0000 UTC'>2020å¹´2æœˆ6æ—¥</span>&nbsp;Â·&nbsp;<span>1 åˆ†</span></footer><a class=entry-link aria-label="post link to My Favorite Usage urfave/cli" href=https://lunarxlark.github.io/articles/20200206_my-favorite-usage-urfave-cli/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Error 'undefined' when go run</h2></header><div class=entry-content><p>xâ€¦motemen/ghqã‚’å†™çµŒã—ã¦ã„ã‚‹æ™‚ã€ go run main.go å‡ºæ¥ãªã„ã“ã¨ã«æ°—ä»˜ã„ãŸã€‚ ä¸‹è¨˜ãŒå®Ÿè¡Œæ™‚ã®ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚ã¡ãªã¿ã«ã€ go build ã¯å‡ºæ¥ã‚‹ã€‚
1 2 3 4 ~/d/s/g/x/ghq >>> go run main.go # command-line-arguments ./main.go:38:17: undefined: commands ~/d/s/g/x/ghq >>> commands ãŒè¦‹ã¤ã‹ã‚‰ãªã„ï¼ŸåŒã˜éšå±¤ã® commands.go ã«ã¯ä¸‹è¨˜è¨˜è¿°ãŒã¡ã‚ƒã‚“ã¨ã‚ã‚‹ã®ã«ã€ã©ã†ã—ã¦è¦‹ã¤ã‹ã‚‰ãªã„â€¦ã€‚
1 2 3 4 5 6 var commands = []*cli.Command{ commandGet, commandList, commandRoot, commandCreate, } ç†ç”±ã¯ã€go runã®å¼•æ•°ã«æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«(+ importã•ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸)ã—ã‹èª­ã¿è¾¼ã¾ãªã„ã‹ã‚‰ã€‚
...</p></div><footer class=entry-footer><span title='2020-02-04 00:00:00 +0000 UTC'>2020å¹´2æœˆ4æ—¥</span>&nbsp;Â·&nbsp;<span>1 åˆ†</span></footer><a class=entry-link aria-label="post link to Error 'undefined' when go run" href=https://lunarxlark.github.io/articles/20200204_how-to-go-run/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://lunarxlark.github.io/>/home/lunarxlark/.config/blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>