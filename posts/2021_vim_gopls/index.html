<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>2021年版 vim + goplsの設定 - /home/lunarxlark/.config/blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:description" content><meta name=twitter:description content><meta name=description content><meta name=description content><meta property="og:title" content="2021年版 vim + goplsの設定 | /home/lunarxlark/.config/blog"><meta name=twitter:title content="2021年版 vim + goplsの設定 | /home/lunarxlark/.config/blog"><meta property="og:image" content><meta itemprop=name content="2021年版 vim + goplsの設定 | /home/lunarxlark/.config/blog"><meta name=application-name content="2021年版 vim + goplsの設定 | /home/lunarxlark/.config/blog"><meta property="og:site_name" content><meta property="og:title" content="2021年版 vim + goplsの設定"><meta property="og:description" content="goplsが出てから, vimでも定義ジャンプやシンボル検索、ドキュメント参照等が行えるようになった。
たまにVSCodeを触りvimでの作業を改善できないか考える中で、自身の設定が古いことに気付いた。また、ググってもなかなか出てこなかったのでメモとして記述する。
cf. GitHub dotfiles
いきなりだが、vimrcとvim-lsp-settings/settings.jsonを抜粋して貼り付ける。
以前、GoではLspCodeAction, LspCodeLens等をサポートしていなかったが、今では使えるようになっている。
キーマップに設定している関数は全てGoで使用出来る。
ただし、カーソルがどこにいても実行出来るわけではないので注意が必要。
LspCodeActionはカーソルの位置によって実行内容が変わるのでそこも注意。
...Plug 'prabirshrestha/vim-lsp'Plug 'mattn/vim-lsp-settings'Plug 'prabirshrestha/asyncomplete-lsp.vim'Plug 'mattn/vim-gomod'...&#34; ------------------------------------------------------------------------------&#34; vim-lsp&#34; ------------------------------------------------------------------------------function! s:on_lsp_buffer_enabled() abort setlocal omnifunc=lsp#complete setlocal signcolumn=yes if exists('+tagfunc') | setlocal tagfunc=lsp#tagfunc | endif nmap <buffer> <leader>ac <plug>(lsp-code-action) nmap <buffer> <leader>cl <plug>(lsp-code-lens) nmap <buffer> <leader>df <plug>(lsp-definition) nmap <buffer> <leader>dd <plug>(lsp-document-diagnostics) nmap <buffer> <leader>im <plug>(lsp-implementation) nmap <buffer> <leader>pdf <plug>(lsp-peek-definition) nmap <buffer> <leader>sm <plug>(lsp-document-symbol-search) nmap <buffer> <leader>Sm <plug>(lsp-workspace-symbol-search) nmap <buffer> <leader>rf <plug>(lsp-references) nmap <buffer> <leader>td <plug>(lsp-type-definition) nmap <buffer> <leader>rn <plug>(lsp-rename) nmap <buffer> <leader>en <plug>(lsp-next-error) nmap <buffer> <leader>ep <plug>(lsp-previous-error) nmap <buffer> <leader>ho <plug>(lsp-hover) let g:lsp_format_sync_timeout = 500 autocmd!"><meta property="og:type" content="article"><meta property="og:url" content="https://lunarxlark.github.io/posts/2021_vim_gopls/"><meta property="article:published_time" content="2021-06-16T08:53:28+09:00"><meta property="article:modified_time" content="2021-06-16T08:53:28+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="2021年版 vim + goplsの設定"><meta name=twitter:description content="goplsが出てから, vimでも定義ジャンプやシンボル検索、ドキュメント参照等が行えるようになった。
たまにVSCodeを触りvimでの作業を改善できないか考える中で、自身の設定が古いことに気付いた。また、ググってもなかなか出てこなかったのでメモとして記述する。
cf. GitHub dotfiles
いきなりだが、vimrcとvim-lsp-settings/settings.jsonを抜粋して貼り付ける。
以前、GoではLspCodeAction, LspCodeLens等をサポートしていなかったが、今では使えるようになっている。
キーマップに設定している関数は全てGoで使用出来る。
ただし、カーソルがどこにいても実行出来るわけではないので注意が必要。
LspCodeActionはカーソルの位置によって実行内容が変わるのでそこも注意。
...Plug 'prabirshrestha/vim-lsp'Plug 'mattn/vim-lsp-settings'Plug 'prabirshrestha/asyncomplete-lsp.vim'Plug 'mattn/vim-gomod'...&#34; ------------------------------------------------------------------------------&#34; vim-lsp&#34; ------------------------------------------------------------------------------function! s:on_lsp_buffer_enabled() abort setlocal omnifunc=lsp#complete setlocal signcolumn=yes if exists('+tagfunc') | setlocal tagfunc=lsp#tagfunc | endif nmap <buffer> <leader>ac <plug>(lsp-code-action) nmap <buffer> <leader>cl <plug>(lsp-code-lens) nmap <buffer> <leader>df <plug>(lsp-definition) nmap <buffer> <leader>dd <plug>(lsp-document-diagnostics) nmap <buffer> <leader>im <plug>(lsp-implementation) nmap <buffer> <leader>pdf <plug>(lsp-peek-definition) nmap <buffer> <leader>sm <plug>(lsp-document-symbol-search) nmap <buffer> <leader>Sm <plug>(lsp-workspace-symbol-search) nmap <buffer> <leader>rf <plug>(lsp-references) nmap <buffer> <leader>td <plug>(lsp-type-definition) nmap <buffer> <leader>rn <plug>(lsp-rename) nmap <buffer> <leader>en <plug>(lsp-next-error) nmap <buffer> <leader>ep <plug>(lsp-previous-error) nmap <buffer> <leader>ho <plug>(lsp-hover) let g:lsp_format_sync_timeout = 500 autocmd!"><script src=https://lunarxlark.github.io/js/feather.min.js></script><link href=https://lunarxlark.github.io/css/fonts.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://lunarxlark.github.io/css/main.css><link rel=stylesheet type=text/css href=https://lunarxlark.github.io/css/dark.css></head><body><div class=content><header><div class=main><a href=https://lunarxlark.github.io/>/home/lunarxlark/.config/blog</a></div><nav><a href=/>Home</a>
<a href=/about>About</a>
<a href=/posts>Posts</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>2021年版 vim + goplsの設定</h1><div class=meta>Posted on Jun 16, 2021</div></div><section class=body><p>goplsが出てから, vimでも定義ジャンプやシンボル検索、ドキュメント参照等が行えるようになった。</p><p>たまにVSCodeを触りvimでの作業を改善できないか考える中で、自身の設定が古いことに気付いた。また、ググってもなかなか出てこなかったのでメモとして記述する。</p><p>cf. <a href=https://github.com/lunarxlark/dotfiles>GitHub dotfiles</a></p><p>いきなりだが、vimrcとvim-lsp-settings/settings.jsonを抜粋して貼り付ける。</p><p>以前、GoではLspCodeAction, LspCodeLens等をサポートしていなかったが、今では使えるようになっている。</p><p>キーマップに設定している関数は全てGoで使用出来る。</p><p>ただし、カーソルがどこにいても実行出来るわけではないので注意が必要。</p><p>LspCodeActionはカーソルの位置によって実行内容が変わるのでそこも注意。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim>...<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>Plug</span> <span style=color:#e6db74>&#39;prabirshrestha/vim-lsp&#39;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>Plug</span> <span style=color:#e6db74>&#39;mattn/vim-lsp-settings&#39;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>Plug</span> <span style=color:#e6db74>&#39;prabirshrestha/asyncomplete-lsp.vim&#39;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>Plug</span> <span style=color:#e6db74>&#39;mattn/vim-gomod&#39;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>...<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>
</span><span style=color:#75715e>&#34; ------------------------------------------------------------------------------</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>&#34; vim-lsp</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>&#34; ------------------------------------------------------------------------------</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>function</span>! <span style=color:#a6e22e>s</span>:<span style=color:#a6e22e>on_lsp_buffer_enabled</span>() <span style=color:#a6e22e>abort</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>setlocal</span> <span style=color:#a6e22e>omnifunc</span>=<span style=color:#a6e22e>lsp</span>#<span style=color:#a6e22e>complete</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>setlocal</span> <span style=color:#a6e22e>signcolumn</span>=<span style=color:#a6e22e>yes</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>exists</span>(<span style=color:#e6db74>&#39;+tagfunc&#39;</span>) | <span style=color:#a6e22e>setlocal</span> <span style=color:#a6e22e>tagfunc</span>=<span style=color:#a6e22e>lsp</span>#<span style=color:#a6e22e>tagfunc</span> | <span style=color:#66d9ef>endif</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>ac</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>code</span>-<span style=color:#a6e22e>action</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>cl</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>code</span>-<span style=color:#a6e22e>lens</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>df</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>definition</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>dd</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>document</span>-<span style=color:#a6e22e>diagnostics</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>im</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>implementation</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>pdf</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>peek</span>-<span style=color:#a6e22e>definition</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>sm</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>document</span>-<span style=color:#a6e22e>symbol</span>-<span style=color:#a6e22e>search</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>Sm</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>workspace</span>-<span style=color:#a6e22e>symbol</span>-<span style=color:#a6e22e>search</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>rf</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>references</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>td</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>type</span>-<span style=color:#a6e22e>definition</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>rn</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>rename</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>en</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>next</span>-<span style=color:#a6e22e>error</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>ep</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>previous</span>-<span style=color:#a6e22e>error</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>nmap</span> &lt;<span style=color:#a6e22e>buffer</span>&gt; &lt;<span style=color:#a6e22e>leader</span>&gt;<span style=color:#a6e22e>ho</span> &lt;<span style=color:#a6e22e>plug</span>&gt;(<span style=color:#a6e22e>lsp</span>-<span style=color:#a6e22e>hover</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>lsp_format_sync_timeout</span> = <span style=color:#ae81ff>500</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>autocmd</span>! <span style=color:#a6e22e>BufWritePre</span> *.<span style=color:#a6e22e>rs</span>,*.<span style=color:#a6e22e>go</span> <span style=color:#a6e22e>call</span> <span style=color:#a6e22e>execute</span>(<span style=color:#e6db74>&#39;LspDocumentFormatSync&#39;</span>)<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>
</span><span style=color:#75715e>    &#34; refer to doc to add more commands</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>endfunction</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>augroup</span> <span style=color:#a6e22e>lsp_install</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>au</span>!<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>    &#34; call s:on_lsp_buffer_enabled only for languages that has the server registered.</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#a6e22e>autocmd</span> <span style=color:#a6e22e>User</span> <span style=color:#a6e22e>lsp_buffer_enabled</span> <span style=color:#a6e22e>call</span> <span style=color:#a6e22e>s</span>:<span style=color:#a6e22e>on_lsp_buffer_enabled</span>()<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>augroup</span> <span style=color:#a6e22e>END</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>vim-lsp-settings/settings.json</span>
{
  <span style=color:#f92672>&#34;go&#34;</span>: {
    <span style=color:#f92672>&#34;gopls&#34;</span>: {
      <span style=color:#f92672>&#34;initialization_options&#34;</span>: {
        <span style=color:#f92672>&#34;analyses&#34;</span> : {<span style=color:#f92672>&#34;fillstruct&#34;</span>:<span style=color:#66d9ef>true</span>},
        <span style=color:#f92672>&#34;staticcheck&#34;</span>: <span style=color:#66d9ef>true</span>,
        <span style=color:#f92672>&#34;directoryFilters&#34;</span>: [
          <span style=color:#e6db74>&#34;-debug&#34;</span>
        ],
        <span style=color:#f92672>&#34;completeUnimported&#34;</span>: <span style=color:#66d9ef>true</span>, <span style=color:#f92672>&#34;usePlaceholders&#34;</span>: <span style=color:#66d9ef>true</span>,
        <span style=color:#f92672>&#34;matcher&#34;</span>: <span style=color:#e6db74>&#34;fuzzy&#34;</span>,
        <span style=color:#f92672>&#34;codelenses&#34;</span>: {
          <span style=color:#f92672>&#34;gc_details&#34;</span>: <span style=color:#66d9ef>false</span>,
          <span style=color:#f92672>&#34;generate&#34;</span>: <span style=color:#66d9ef>true</span>,
          <span style=color:#f92672>&#34;test&#34;</span>: <span style=color:#66d9ef>true</span>,
          <span style=color:#f92672>&#34;tidy&#34;</span>: <span style=color:#66d9ef>true</span>,
          <span style=color:#f92672>&#34;vendor&#34;</span>: <span style=color:#66d9ef>false</span>
        },
        <span style=color:#f92672>&#34;hoverKind&#34;</span>: <span style=color:#e6db74>&#34;SynopsisDocumentation&#34;</span>
      }
    }
  }
}
</code></pre></div><h2 id=vim--goplsで新しく設定したこと>vim + goplsで新しく設定したこと</h2><h3 id=lspcodeaction>LspCodeAction</h3><p>vim-lspのhelpにあるように、LspCodeActionが実行出来る行では <code>A></code> が表示される。</p><p>Goで出来るCodeAction全体はわからないが、今のところは下記が出来ることを確認した。</p><ul><li>structを初期値で補完 (要設定: <code>"analyses": {"fillstruct": true}</code>)</li><li>returnで関数フォーマットを補完</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#75715e>&#34;:help vim-lsp.txt</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>lsp_document_code_action_signs_enabled</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>                               *<span style=color:#a6e22e>g</span>:<span style=color:#a6e22e>lsp_document_code_action_signs_enabled</span>*<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>...<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    `<span style=color:#a6e22e>LspCodeActionText</span>` <span style=color:#a6e22e>defaults</span> <span style=color:#a6e22e>to</span> `<span style=color:#a6e22e>A</span>&gt;`.<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>...<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p><img src=/images/screenshot_20210616-093637.png alt=LspCodeAction></p><h3 id=lspdocumentdiagnostics>LspDocumentDiagnostics</h3><p>(これは以前から設定できたみたい。)</p><p>golintがdeprecatedになったので、linterにstaticcheckを設定したかった。</p><p>また、VSCodeのタブ <code>PROBLEMS</code> のようにコードでの問題箇所を確認したかった。</p><p>(staticcheckのどのケースにひっかかったのかがわからない&mldr;。AXXXも出力したい。)</p><p><img src=/images/screenshot_20210616-100337.png alt=LspDocDiagnostics></p><h3 id=lspcodelens>LspCodeLens</h3><p>vim-lsp-settings/settings.jsonにある機能がファイルに応じて出来るようになる。</p><ul><li><code>_test.go</code> -> <code>go test</code></li></ul><p><img src=/images/screenshot_20210616-093830.png alt=LspCodeLens-test></p><ul><li><code>go.mod</code> -> <code>go tidy</code> (go.modのfiletypeをgo or gomodにする必要がある。mattn/vim-gomodを入れるのが無難。)</li></ul><p><img src=/images/screenshot_20210616-095605.png alt=LspCodeLens-tidy></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#75715e>&#34;:help vim-lsp.txt</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>LspCodeLens</span>                                                   *:<span style=color:#a6e22e>LspCodeLens</span>*<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>Gets</span> <span style=color:#a6e22e>a</span> <span style=color:#a6e22e>list</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>possible</span> <span style=color:#a6e22e>commands</span> <span style=color:#a6e22e>that</span> <span style=color:#a6e22e>can</span> <span style=color:#a6e22e>be</span> <span style=color:#a6e22e>executed</span> <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>current</span> <span style=color:#a6e22e>document</span>.<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><h2 id=まとめ>まとめ</h2><p>2021年になり、goplsはとても使い心地よく改善されてきました。</p><p>まだ手の届かないところがありますが、たくさんのプラグインを入れることなくgoplsで出来るだけ済むように設定することでメンテしやすくなったと思います。</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/vim>vim</a></li><li><a href=/tags/go>go</a></li><li><a href=/tags/gopls>gopls</a></li></ul></nav></div></article></main><footer><hr><a class=soc href=https://github.com/lunarxlark/ title=GitHub><i data-feather=github></i></a>|<a class=soc href=https://twitter.com/lunarxlark/ title=Twitter><i data-feather=twitter></i></a>|<a class=soc href=https://instagram.com/lunarxlark/ title=Instagram><i data-feather=instagram></i></a>|⚡️
2021 © lunarxlark | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-135352101-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script>feather.replace()</script></div></body></html>